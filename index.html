<!DOCTYPE html>
<html>
  <head>
    <link href="styles.css" rel="stylesheet"></link>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="moment.min.js"></script>
  </head>
  <body>

    <div class="header">
      <ul class="nav">
        <li>test 1</li>
        <li>test 2</li>
        <li>test 3</li>
      </ul>
    </div>
    <div class="space"></div>

    <div class="main">
      <div class="refresh">REFRESH DEM TWEETS</div>
      <div class="tweets">
      </div>
    </div>

    <div class="footer">this is a footer!</div>

    <script>

      $(document).ready(function(){
        
        var lastDisplayedIndex;
        var $tweets = $('.tweets');

        function buildTweet(theTweet) {
          var $tweet = $('<div class="tweet"></div>');
          var $user = $('<div class="user"></div>');
          var $message = $('<div class="message"></div>');
          var $timestamp = $('<div class="timestamp"></div>');
          var momentTimestamp = moment(theTweet.created_at);
          var coolTimestamp = moment(momentTimestamp).fromNow();
          $user.text('@' + theTweet.user)
          $message.text(theTweet.message);
          $timestamp.text(coolTimestamp);
          $user.appendTo($tweet);
          $message.appendTo($tweet);
          $timestamp.appendTo($tweet);
          return $tweet;
        };

        function addNewTweets (isFirstTime) {
          var index = streams.home.length - 1;
          var tempIndex = index;

          while(index >= 0) {
            var tweet = streams.home[index];
            
            if (!isFirstTime) { //if we're adding the newest tweets...
              if (index > lastDisplayedIndex) {//only add the new tweets
                buildTweet(tweet).prependTo($tweets);
              }
            } else { //if it's the first time keep it simple, add all
              buildTweet(tweet).prependTo($tweets);
            }
            index -= 1;
          }

          lastDisplayedIndex = tempIndex;
        };

        function refreshTweets() {
          addNewTweets(false);
        }

        $('.refresh').on("click", refreshTweets);
        
        addNewTweets(true);

      });

    </script>
  </body>
</html>
